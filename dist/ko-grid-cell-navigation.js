/*
 Copyright (c) 2015, Ben Schulz
 License: BSD 3-clause (http://opensource.org/licenses/BSD-3-Clause)
*/
function u(q,y){return function(f){return f}(function(f,l,p,a){var b=[38,37,39,40,9,13];a.defineExtension("ko-grid-cell-navigation",{C:function(a){a.before("table").insert('<textarea class="ko-grid-focus-parking" tabIndex="-1" style="position: absolute; z-index: 10; overflow: hidden; box-sizing: border-box; width: 1em; height: 1em; top: -3em; left: -3em; resize: none; border: none;"></textarea>')},A:function(a,f,g){function m(h,c,a){a=!!a;var b=g.data.rows.displayed(),e=g.columns.displayed();h=void 0+
h;c=e.indexOf(r)+c;a&&0>c?(--h,c=e.length-1):a&&c>=e.length&&(h+=1,c=0);c=Math.max(0,Math.min(e.length-1,c));h=Math.max(0,Math.min(b.length-1,h));v(b.get(h),e[c])}function v(a,c){var b=g.data.lookupCell(a,c);a===w&&c===r||q(a,c,b);if(!p.l(g.rootElement,window.document.activeElement)){var k=b.element.querySelector("input, select, textarea");k||(n.value=c.renderValue(l.unwrap(a[c.property])),n.setSelectionRange(0,n.value.length),k=n);k.focus()}var k=b.element,b=d.getBoundingClientRect(),e=k.getBoundingClientRect(),
k=Math.min(0,e.left-b.left-7)||Math.max(0,e.right-b.right+7+(d.offsetWidth-d.clientWidth)),b=Math.min(0,e.top-b.top-7)||Math.max(0,e.bottom-b.bottom+7+(d.offsetHeight-d.clientHeight));d.scrollLeft+=k;d.scrollTop+=b}function q(a,b,d){t&&t.release();t=d.hijack(function(d){return x.reduce(function(e,d){return d(a,b,e)||e},{init:function(a,b,c){var h=arguments;w=b;r=c;d.init.apply(this,h);a.classList.add("focused")},update:function(a){d.update.apply(this,arguments);a.classList.add("focused")}})})}var x=
[];this.onCellFocused=this.m=function(a){return x.push(a)};var d=null,n=null,w=null,r=null,t=null;g.postApplyBindings(function(){d=g.element.querySelector(".ko-grid-table-scroller");n=g.element.querySelector(".ko-grid-focus-parking")});g.data.onCellClick(function(a,b,d,g){return v(d,g)});g.onKeyDown(function(a){if(!(a.defaultPrevented||0>b.indexOf(a.keyCode))){a.preventDefault();var c=a.shiftKey?-1:1;switch(a.keyCode){case 38:return m(-1,0);case 37:return m(0,-1);case 39:return m(0,1);case 40:return m(1,
0);case 9:return m(0,c,!0);case 13:return m(c,0)}}})}});return a.declareExtensionAlias("cellNavigation","ko-grid-cell-navigation")}({},y,function(){return function(f){return f}(function(){function f(a,b){return!!(a.compareDocumentPosition(b)&16)}var l=window.Element,p=l.prototype.webkitMatchesSelector||l.prototype.mozMatchesSelector||l.prototype.msMatchesSelector||l.prototype.matches;return{r:function(a,b){for(var f=0;b;){if(b===a)return f;b=b.parentNode;++f}throw Error("The given node is not part of the subtree.");
},l:function(a,b){return a===b||f(a,b)},u:f,element:{q:function(a,b){do{if(p.call(a,b))return a;a=a.parentElement}while(a);return null},matches:function(a,b){return p.call(a,b)}}}}())}(),q))}"function"===typeof define&&define.amd?define(["ko-grid","knockout","ko-data-source","ko-indexed-repeat"],u):window["ko-grid-cell-navigation"]=u(window.ko.bindingHandlers.grid,window.ko);