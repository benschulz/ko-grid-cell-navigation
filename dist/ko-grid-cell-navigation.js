/*
 Copyright (c) 2015, Ben Schulz
 License: BSD 3-clause (http://opensource.org/licenses/BSD-3-Clause)
*/
function r(g,l){return function(m){return m}(function(m,g,n){var l=[38,37,39,40,9,13];n.defineExtension("ko-grid-cell-navigation",{v:function(g){g.before("table").insert('<textarea class="ko-grid-focus-parking" tabIndex="-1" style="position: absolute; z-index: 10; overflow: hidden; box-sizing: border-box; width: 1em; height: 1em; top: -3em; left: -3em; resize: none; border: none;"></textarea>')},t:function(m,n,e){function f(a,b,c){c=!!c;var d=e.data.rows.displayed(),h=e.columns.displayed();a=void 0+
a;b=h.indexOf(p)+b;c&&0>b?(--a,b=h.length-1):c&&b>=h.length&&(a+=1,b=0);b=Math.max(0,Math.min(h.length-1,b));a=Math.max(0,Math.min(d.length-1,a));t(d.get(a),h[b])}function t(a,b){if(a!==u||b!==p){q&&q.release();var c=e.data.lookupCell(a,b);k.focus();k.value=b.renderValue(g.unwrap(a[b.property]));k.setSelectionRange(0,k.value.length);q=c.hijack(function(c){return v.reduce(function(c,d){return d(a,b,c)||c},{init:function(a,b,d){var e=arguments;u=b;p=d;c.init.apply(this,e);a.classList.add("focused")},
update:function(a){c.update.apply(this,arguments);a.classList.add("focused")}})});w(c.element)}}function w(a){var b=d.getBoundingClientRect(),c=a.getBoundingClientRect();a=Math.min(0,c.left-b.left-7)||Math.max(0,c.right-b.right+7+(d.offsetWidth-d.clientWidth));b=Math.min(0,c.top-b.top-7)||Math.max(0,c.bottom-b.bottom+7);d.scrollLeft+=a;d.scrollTop+=b}var v=[];this.onCellFocused=this.l=function(a){return v.push(a)};var d=null,k=null,u=null,p=null,q=null;e.postApplyBindings(function(){d=e.element.querySelector(".ko-grid-table-scroller");
k=e.element.querySelector(".ko-grid-focus-parking")});e.data.onCellClick(function(a,b,c,d){return t(c,d)});e.onKeyDown(function(a){if(!(a.defaultPrevented||0>l.indexOf(a.keyCode))){a.preventDefault();var b=a.shiftKey?-1:1;switch(a.keyCode){case 38:return f(-1,0);case 37:return f(0,-1);case 39:return f(0,1);case 40:return f(1,0);case 9:return f(0,b,!0);case 13:return f(b,0)}}})}});return n.declareExtensionAlias("cellNavigation","ko-grid-cell-navigation")}({},l,g))}
"function"===typeof define&&define.amd?define(["ko-grid","knockout","ko-data-source","ko-indexed-repeat"],r):window["ko-grid-cell-navigation"]=r(window.ko.bindingHandlers.grid,window.ko);