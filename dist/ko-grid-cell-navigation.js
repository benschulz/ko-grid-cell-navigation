/*
 Copyright (c) 2015, Ben Schulz
 License: BSD 3-clause (http://opensource.org/licenses/BSD-3-Clause)
*/
function r(n,w){return function(f){return f}(function(f,h,m,a){var b=[38,37,39,40,9,13];a.defineExtension("ko-grid-cell-navigation",{C:function(a){a.before("table").insert('<textarea class="ko-grid-focus-parking" tabIndex="-1" style="position: absolute; z-index: 10; overflow: hidden; box-sizing: border-box; width: 1em; height: 1em; top: -3em; left: -3em; resize: none; border: none;"></textarea>')},A:function(a,f,g){function k(e,c,a){a=!!a;var b=g.data.rows.displayed(),d=g.columns.displayed();e=void 0+
e;c=d.indexOf(p)+c;a&&0>c?(--e,c=d.length-1):a&&c>=d.length&&(e+=1,c=0);c=Math.max(0,Math.min(d.length-1,c));e=Math.max(0,Math.min(b.length-1,e));t(b.get(e),d[c])}function t(e,c){if(e!==u||c!==p){q&&q.release();var a=g.data.lookupCell(e,c);q=a.hijack(function(a){return v.reduce(function(a,b){return b(e,c,a)||a},{init:function(e,c,b){var d=arguments;u=c;p=b;a.init.apply(this,d);e.classList.add("focused")},update:function(e){a.update.apply(this,arguments);e.classList.add("focused")}})});if(!m.l(g.rootElement,
window.document.activeElement)){var b=a.element.querySelector("input, select, textarea");b||(l.value=c.renderValue(h.unwrap(e[c.property])),l.setSelectionRange(0,l.value.length),b=l);b.focus()}n(a.element)}}function n(a){var c=d.getBoundingClientRect(),b=a.getBoundingClientRect();a=Math.min(0,b.left-c.left-7)||Math.max(0,b.right-c.right+7+(d.offsetWidth-d.clientWidth));c=Math.min(0,b.top-c.top-7)||Math.max(0,b.bottom-c.bottom+7+(d.offsetHeight-d.clientHeight));d.scrollLeft+=a;d.scrollTop+=c}var v=
[];this.onCellFocused=this.m=function(a){return v.push(a)};var d=null,l=null,u=null,p=null,q=null;g.postApplyBindings(function(){d=g.element.querySelector(".ko-grid-table-scroller");l=g.element.querySelector(".ko-grid-focus-parking")});g.data.onCellClick(function(a,b,d,g){return t(d,g)});g.onKeyDown(function(a){if(!(a.defaultPrevented||0>b.indexOf(a.keyCode))){a.preventDefault();var c=a.shiftKey?-1:1;switch(a.keyCode){case 38:return k(-1,0);case 37:return k(0,-1);case 39:return k(0,1);case 40:return k(1,
0);case 9:return k(0,c,!0);case 13:return k(c,0)}}})}});return a.declareExtensionAlias("cellNavigation","ko-grid-cell-navigation")}({},w,function(){return function(f){return f}(function(){function f(a,b){return!!(a.compareDocumentPosition(b)&16)}var h=window.Element,m=h.prototype.webkitMatchesSelector||h.prototype.mozMatchesSelector||h.prototype.msMatchesSelector||h.prototype.matches;return{r:function(a,b){for(var f=0;b;){if(b===a)return f;b=b.parentNode;++f}throw Error("The given node is not part of the subtree.");
},l:function(a,b){return a===b||f(a,b)},u:f,element:{q:function(a,b){do{if(m.call(a,b))return a;a=a.parentElement}while(a);return null},matches:function(a,b){return m.call(a,b)}}}}())}(),n))}"function"===typeof define&&define.amd?define(["ko-grid","knockout","ko-data-source","ko-indexed-repeat"],r):window["ko-grid-cell-navigation"]=r(window.ko.bindingHandlers.grid,window.ko);